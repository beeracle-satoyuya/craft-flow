<!-- 0f9934ba-83dd-4f4a-b0f0-7e96c5359a79 0ac8d7bd-6b65-42ce-90a1-5540cda7ca74 -->
# 全銀フォーマット変換機能の実装

## 概要

エクセルファイル（顧客情報）をアップロードし、全銀フォーマット（固定長形式）の総合振込レコードに自動変換してダウンロードできる機能を実装します。

## 実装内容

### 1. ルーティング追加

- `routes/web.php`に全銀フォーマット変換ページのルートを追加
- 認証済みユーザーがアクセス可能

### 2. Volt Functionalコンポーネント作成

- `resources/views/livewire/bank-transfers/index.blade.php`を作成
- 既存の`consignment-sales/index.blade.php`のパターンを参考に実装

### 3. エクセルファイルアップロード機能

- Livewireの`WithFileUploads`トレイトを使用
- ファイル形式: `.xlsx`, `.xls`（最大10MB）
- ドラッグ&ドロップ対応のUI
- アップロード中のローディング表示

### 4. 全銀フォーマット変換ロジック

- `app/Actions/BankTransfer/ConvertToZenkinFormat.php`を作成
- エクセル列から全銀フォーマットへのマッピング処理
- 固定長形式の文字列生成（JISコード、スペース埋め、0埋め）

#### エクセル列マッピング

提供された列構成から全銀フォーマットへの変換：

- 振込依頼人コード: 顧客IDから取得（10桁、右詰め0埋め）
- 振込依頼人名: 事業者名から取得（40文字、左詰めスペース）
- 取組日: 振込予定日から取得（MMDD形式）
- 仕向銀行番号: 金融機関コードから取得（4桁）
- 仕向銀行名: 金融機関名から取得（15文字、左詰めスペース）
- 仕向支店番号: 支店コードから取得（3桁）
- 仕向支店名: 支店名から取得（15文字、左詰めスペース）
- 預金種目: 預金種目から取得（1桁: 1=普通、2=当座、9=その他）
- 口座番号: 口座番号から取得（7桁、右詰め0埋め）

#### 全銀フォーマット仕様

- ヘッダーレコード: 120バイト固定長
- データ区分: 1（ヘッダー）
- 種別コード: 21（総合振込）
- コード区分: 0（JIS）
- 文字エンコーディング: JIS（Shift_JIS）

### 5. ファイル生成とダウンロード機能

- 変換後の全銀フォーマットファイルを一時保存
- ダウンロード用のレスポンスを返す
- ダウンロード後、一時ファイルを削除

### 6. UI実装

- Flux UIコンポーネントを使用
- エクセルファイル形式の説明表示
- 変換結果のプレビュー表示
- エラーハンドリングとメッセージ表示

## 技術的な考慮事項

### 文字エンコーディング

- 全銀フォーマットはJISコード（Shift_JIS）を使用
- PHPの`mb_convert_encoding()`で変換

### 固定長フォーマット処理

- `str_pad()`でスペース埋め・0埋めを実装
- 文字数制限の厳格なチェック

### エラーハンドリング

- エクセルファイルの読み込みエラー
- 必須項目の欠損チェック
- データ形式のバリデーション

## ファイル構成

```
app/
  Actions/
    BankTransfer/
      ConvertToZenkinFormat.php  # 全銀フォーマット変換ロジック

resources/views/livewire/
  bank-transfers/
    index.blade.php  # メインコンポーネント

routes/
  web.php  # ルーティング追加
```

## 実装のポイント

1. 既存の`consignment-sales/index.blade.php`のパターンを踏襲
2. Volt Functionalスタイルで実装
3. エクセル列のヘッダー行を動的に検出（柔軟性向上）
4. 変換前のデータプレビュー機能
5. 一時ファイルはダウンロード後に自動削除

### To-dos

- [ ] 全銀フォーマット変換用のActionクラス（ConvertToZenkinFormat.php）を作成し、エクセルデータから全銀フォーマットへの変換ロジックを実装
- [ ] Volt Functionalコンポーネント（bank-transfers/index.blade.php）を作成し、エクセルアップロード、変換、ダウンロード機能を実装
- [ ] routes/web.phpに全銀フォーマット変換ページのルートを追加
- [ ] 全銀フォーマット変換機能のテストを作成（エクセル読み込み、変換ロジック、ダウンロード）